{% extends 'admin/baseAI.html' %}

{% block title %}KNN Training - FindMyDog{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-6" x-data="modelSelector()" x-init="init()">
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-800 p-6 rounded-2xl shadow-lg text-white">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold mb-2">test KNN classification</h1>
          <p class="text-purple-100">‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö embeding ‡∏î‡πâ‡∏ß‡∏¢ algorithm KNN</p>
        </div>
        <div class="p-4 bg-white bg-opacity-20 rounded-xl backdrop-blur-sm">
          <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
          </svg>
        </div>
      </div>
    </div>
  
    <!-- Current Active Model Card -->
    <div class="bg-white p-6 rounded-xl shadow-sm border-2 border-indigo-200"
         x-show="currentModel"
         x-transition>
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <div class="p-3 bg-indigo-100 rounded-lg">
            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div>
            <p class="text-sm text-gray-500 font-medium">Model ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>
            <p class="text-xl font-bold text-gray-800" x-text="currentModel.active_model || 'N/A'"></p>
            <p class="text-xs text-gray-500 mt-1" x-text="'Device: ' + (currentModel.device || 'N/A')"></p>
            <p class="text-xs text-gray-500 mt-1 font-mono" x-text="getModelPath(currentModel.active_model)"></p>
          </div>
        </div>
        <div class="px-4 py-2 bg-green-100 text-green-700 rounded-lg font-semibold text-sm">
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        </div>
      </div>
    </div>

    <!-- Run KNN Test Button + Explanation -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Left: control -->
      <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-dashed border-indigo-300">
        <form method="post" action="{% url 'train_knn' %}" class="space-y-4">
          {% csrf_token %}
          <p class="text-sm text-gray-600">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥ <span class="font-semibold text-indigo-700">embedding_binary</span> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
            ‡πÑ‡∏õ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô FastAPI ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Visualization ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
          </p>
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-500">
              {% if count %}
                <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô embedding ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: <span class="font-semibold text-indigo-700">{{ count }}</span></span>
              {% else %}
                <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
              {% endif %}
            </div>
            <button type="submit"
                    class="inline-flex items-center px-5 py-2.5 rounded-lg bg-indigo-600 text-white text-sm font-semibold shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M5 13l4 4L19 7" />
              </svg>
              ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Embedding KNN
            </button>
          </div>
          {% if status %}
            <div class="mt-2 text-sm {% if status == 'success' %}text-green-600{% else %}text-red-600{% endif %}">
              {{ message }}
            </div>
          {% endif %}
        </form>
      </div>

      <!-- Right: how-to / explanation -->
      <div class="bg-white p-4 rounded-xl shadow-sm border border-indigo-100">
        <h2 class="text-sm font-semibold text-gray-800 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö & ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</h2>
        <ul class="text-xs text-gray-600 space-y-1 list-disc list-inside">
          <li>‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ <span class="font-semibold text-indigo-700">KNN</span> ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ <span class="font-mono">n_neighbors = 3</span> (‡∏î‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 3 ‡∏à‡∏∏‡∏î)</li>
          <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå <span class="font-mono">embedding_binary</span> ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
          <li>‡∏Å‡∏£‡∏≤‡∏ü <span class="font-semibold">t-SNE</span> ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏°‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡πÉ‡∏ô 2 ‡∏°‡∏¥‡∏ï‡∏¥</li>
          <li><span class="font-semibold">Confusion Matrix</span> ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î‡∏Ç‡∏≠‡∏á KNN ‡πÇ‡∏î‡∏¢‡πÅ‡∏Å‡∏ô Y ‡∏Ñ‡∏∑‡∏≠ Dog ID ‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡∏ô X ‡∏Ñ‡∏∑‡∏≠ Dog ID ‡∏ó‡∏µ‡πà‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</li>
          <li>‡∏Ñ‡πà‡∏≤‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡πÅ‡∏¢‡∏á‡∏°‡∏∏‡∏° (Diagonal) ‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ</li>
          <li>‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡πÉ‡∏´‡πâ‡∏°‡∏µ embedding ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
        </ul>
      </div>
    </div>

    <!-- Visualization Results -->
    {% if result %}
    <div class="space-y-6">
      <!-- Results Summary Card -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Total Embeddings -->
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-xl shadow-sm border border-blue-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-blue-600 uppercase tracking-wide">Embedding ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
              <p class="text-3xl font-bold text-blue-900 mt-2">{{ result.count }}</p>
            </div>
            <div class="p-3 bg-blue-200 rounded-lg">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 1.105 1.343 2 3 2h2c1.657 0 3-.895 3-2v-10c0-1.105-1.343-2-3-2H7c-1.657 0-3 .895-3 2z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Accuracy Score -->
        <div class="bg-gradient-to-br from-green-50 to-green-100 p-5 rounded-xl shadow-sm border border-green-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-green-600 uppercase tracking-wide">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p>
              <p class="text-3xl font-bold text-green-900 mt-2">{{ result.accuracy|floatformat:2 }}%</p>
            </div>
            <div class="p-3 bg-green-200 rounded-lg">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Model Used -->
        <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-5 rounded-xl shadow-sm border border-amber-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-amber-600 uppercase tracking-wide">Model ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</p>
              <p class="text-lg font-bold text-amber-900 mt-2" title="{{ result.model_name }}">{{ result.model_name|truncatewords:3 }}</p>
            </div>
            <div class="p-3 bg-amber-200 rounded-lg">
              <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Created Date -->
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-5 rounded-xl shadow-sm border border-purple-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-purple-600 uppercase tracking-wide">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
              <p class="text-sm font-bold text-purple-900 mt-2">{{ result.created_at|date:"d/m/Y" }}</p>
              <p class="text-xs text-purple-700 mt-1">{{ result.created_at|time:"H:i" }} ‡∏ô.</p>
            </div>
            <div class="p-3 bg-purple-200 rounded-lg">
              <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Algorithm Info -->
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-5 rounded-xl shadow-sm border border-orange-200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs font-medium text-orange-600 uppercase tracking-wide">Algorithm</p>
              <p class="text-sm font-bold text-orange-900 mt-2">KNN (n=3)</p>
              <p class="text-xs text-orange-700 mt-1">Euclidean Distance</p>
            </div>
            <div class="p-3 bg-orange-200 rounded-lg">
              <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Visualization Cards -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- t-SNE Plot -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
            <h2 class="text-lg font-bold text-white flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
              </svg>
              t-SNE Visualization
            </h2>
            <p class="text-blue-100 text-xs mt-1">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á Embedding ‡πÉ‡∏ô 2 ‡∏°‡∏¥‡∏ï‡∏¥</p>
          </div>
          <div class="p-4 bg-gray-50">
            {% if result.tsne_image %}
              <div class="border-2 border-dashed border-blue-300 rounded-lg overflow-hidden bg-white">
                <img src="{{ result.tsne_image.url }}" alt="t-SNE Plot" class="w-full h-auto object-contain max-h-96">
              </div>
              <p class="text-xs text-gray-500 mt-3 text-center">
                <span class="inline-block bg-blue-100 text-blue-700 px-3 py-1 rounded-full">
                  ‚úì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                </span>
              </p>
            {% else %}
              <div class="flex flex-col items-center justify-center h-96 text-gray-400">
                <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                <p class="text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</p>
              </div>
            {% endif %}
          </div>
          <div class="px-6 py-3 bg-gray-100 border-t border-gray-200">
            <p class="text-xs text-gray-600">
              <span class="font-semibold">üìä ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô:</span> ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å
            </p>
          </div>
        </div>

        <!-- KNN Confusion Matrix -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
          <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
            <h2 class="text-lg font-bold text-white flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              KNN Confusion Matrix
            </h2>
            <p class="text-green-100 text-xs mt-1">‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</p>
          </div>
          <div class="p-4 bg-gray-50">
            {% if result.knn_matrix_image %}
              <div class="border-2 border-dashed border-green-300 rounded-lg overflow-hidden bg-white">
                <img src="{{ result.knn_matrix_image.url }}" alt="KNN Confusion Matrix" class="w-full h-auto object-contain max-h-96">
              </div>
              <p class="text-xs text-gray-500 mt-3 text-center">
                <span class="inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full">
                  ‚úì ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡πÅ‡∏¢‡∏á‡∏°‡∏∏‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                </span>
              </p>
            {% else %}
              <div class="flex flex-col items-center justify-center h-96 text-gray-400">
                <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                <p class="text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</p>
              </div>
            {% endif %}
          </div>
          <div class="px-6 py-3 bg-gray-100 border-t border-gray-200">
            <p class="text-xs text-gray-600">
              <span class="font-semibold">üìà ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô:</span> ‡πÅ‡∏Å‡∏ô Y = Dog ID ‡∏à‡∏£‡∏¥‡∏á, ‡πÅ‡∏Å‡∏ô X = Dog ID ‡∏ó‡∏µ‡πà‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡πÅ‡∏¢‡∏á‡∏°‡∏∏‡∏°‡πÄ‡∏Ç‡πâ‡∏° = ‡∏¢‡∏¥‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
            </p>
          </div>
        </div>
      </div>

      <!-- Detailed Analysis Section -->
      <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Performance Metrics -->
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-3 text-sm">üìä ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</h3>
            <ul class="space-y-2 text-sm">
              <li class="flex justify-between">
                <span class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Samples:</span>
                <span class="font-semibold text-gray-800">{{ result.count }}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-600">Model:</span>
                <span class="font-semibold text-amber-700 font-mono text-xs" title="{{ result.model_name }}">{{ result.model_name|truncatewords:2 }}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-600">Accuracy:</span>
                <span class="font-semibold text-green-600">{{ result.accuracy|floatformat:2 }}%</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-600">Error Rate:</span>
                <span class="font-semibold text-red-600">{{ error_rate|default:"0.00" }}%</span>
              </li>
            </ul>
          </div>

          <!-- Model Configuration -->
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-3 text-sm">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
            <ul class="space-y-2 text-sm">
              <li class="flex justify-between">
                <span class="text-gray-600">Neighbors (k):</span>
                <span class="font-semibold text-gray-800">3</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-600">Distance Metric:</span>
                <span class="font-semibold text-gray-800">Euclidean</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-600">Test Split:</span>
                <span class="font-semibold text-gray-800">Cross-Val</span>
              </li>
            </ul>
          </div>

          <!-- Interpretation Guide -->
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-3 text-sm">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
            {% if result.accuracy >= 90 %}
              <p class="text-sm text-green-700">‚úì ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>
            {% elif result.accuracy >= 70 %}
              <p class="text-sm text-blue-700">‚Üí ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å</p>
            {% elif result.accuracy >= 50 %}
              <p class="text-sm text-orange-700">‚ö† ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• embedding</p>
            {% else %}
              <p class="text-sm text-red-700">‚úó ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ model default</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3 justify-center">
        <a href="{% url 'train_knn' %}" class="inline-flex items-center px-6 py-3 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition-colors">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        </a>
        <a href="{% url 'page_select_model' %}" class="inline-flex items-center px-6 py-3 rounded-lg bg-gray-600 text-white font-semibold hover:bg-gray-700 transition-colors">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
        </a>
      </div>
    </div>
    {% else %}
    <!-- No Results Yet -->
    <div class="bg-white rounded-xl shadow-lg p-12 text-center border border-gray-200">
      <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
    </div>
    {% endif %}
</div>
{% endblock %}
