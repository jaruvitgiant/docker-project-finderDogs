{% extends "base.html" %}
{% load static %}
{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: {{ dog.name }}{% endblock %} 

{% block extra_head %}
<!-- Dropzone Custom CSS -->
<link rel="stylesheet" href="{% static 'dropzone-custom.css' %}">
{% endblock %}

{% block content %}
    <div class="max-w-4xl mx-auto p-8">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-4xl font-extrabold text-gray-800">{{ dog.name }} <span class="text-xl">üêï</span></h1>
        </div>
        
        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} mb-2">
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <div class="mb-6">
            {% if dog.is_lost and not dog.organization %}
                <div role="alert" class="alert alert-error text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>‚ö†Ô∏è **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏´‡∏≤‡∏¢ (LOST) ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á!</span>
                </div>
            {% elif not dog.is_lost and not og.organization %}
                <span class="badge badge-lg badge-success text-white font-bold">üè† ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</span>
            {% endif %}
            {% if dog.is_lost and dog.organization %}
                <div role="alert" class="alert alert-error text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>‚ö†Ô∏è **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏´‡∏≤‡∏¢ (LOST) ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÇ‡∏Æ‡∏á‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏´‡∏°‡∏≤!</span>
                </div>
            {% elif not dog.is_lost and og.organization %}
                <span class="badge badge-lg badge-success text-white font-bold">üè† ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÇ‡∏Æ‡∏á‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏´‡∏°‡∏≤</span>
            {% endif %}
        </div>
        
        {% if is_edit_mode %}
            {# ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç - ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° #}
            <form method="post" enctype="multipart/form-data" id="dog-edit-form" class="space-y-8">
                {% csrf_token %}
                
                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">{{ form.name.label_tag }}{{ form.name }}</div>
                        <div class="form-control">{{ form.age.label_tag }}{{ form.age }}</div>
                        
                        <div class="form-control">
                            {% comment %} <label class="label">{{ form.gender.label }}</label> {% endcomment %}
                            {{ form.gender.label }}
                            {{ form.gender }}
                        </div>
                    </div>
                </div>
    
                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">{{ form.primary_color.label_tag }}{{ form.primary_color }}</div>
                        <div class="form-control">{{ form.secondary_color.label_tag }}{{ form.secondary_color }}</div>
                        
                        <div class="form-control md:col-span-3">
                            {{ form.distinguishing_marks.label_tag }}
                            {{ form.distinguishing_marks }}
                        </div>
                    </div>
                </div>
    
                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß</h2>
                    <div class="grid grid-cols-1 gap-4">
                        <div class="form-control">
                            {{ form.size.label }}
                            {{ form.size }}
                        </div>
                        <span>
                            <img src="{% static 'dogsizepng.png' %}">
                        </span>
                    </div>
                </div>
                
                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">{{ form.personality.label_tag }}{{ form.personality }}</div>
                        <div class="form-control">{{ form.favorite_food.label_tag }}{{ form.favorite_food }}</div>
                        <div class="form-control">{{ form.allergies.label_tag }}{{ form.allergies }}</div>
                    </div>
                </div>
                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</h2>
                    <div class="form-control mt-4">
                        <label class="label cursor-pointer justify-start gap-3">
                            {{ form.is_lost }}
                            {% comment %} <span class="label-text text-lg">{{ form.is_lost.label }}</span> {% endcomment %}
                        </label>
                    </div>
                </div>
                {% if is_org %}
                    <h2 class="text-2xl font-bold text-gray-700 mt-8 mb-4 border-t pt-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•)</h2>
                    <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                        <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î (‡∏ó‡∏≥‡∏´‡∏°‡∏±‡∏ô)</h2>
                        <div class="form-control">{{ form.sterilization_status.label_tag }}{{ form.sterilization_status }}</div>
                        <div class="form-control">{{ form.sterilization_date.label_tag }}{{ form.sterilization_date }}</div>
                    </div>
                    <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                        <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß</h2>
                        <div class="form-control">{{ form.vaccine_selection.label_tag }}{{ form.vaccine_selection }}</div>
                    </div>
                {% endif %}




                <div class="bg-base-100 p-6 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-semibold text-primary-blue-custom mb-4">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏∏‡∏ô‡∏±‡∏Ç (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ)</h2>
                    
                    {# ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà #}
                    {% if dog_images %}
                        <div class="mb-4">
                            <h3 class="text-md font-semibold text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</h3>
                            <div id="existing-images" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                                {% for image_form in formset %}
                                    {% if image_form.instance.pk %}
                                        <div class="relative existing-image-item" data-image-id="{{ image_form.instance.pk }}">
                                            <img src="{{ image_form.instance.image.url }}" alt="‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô" class="w-full h-32 object-cover rounded-md border">
                                            <button type="button" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 remove-existing-image" data-form-index="{{ forloop.counter0 }}">
                                                √ó
                                            </button>
                                            {% if image_form.DELETE %}
                                                {{ image_form.DELETE }}
                                            {% endif %}
                                            {% if image_form.id %}
                                                {{ image_form.id }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    
                    {# Dropzone Area ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà #}
                    <div id="dropzone-area" class="dropzone">
                        <div class="dz-message">
                            <p class="text-lg text-gray-600 mb-2">‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                        </div>
                    </div>
                    
                    {# Hidden formset ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà #}
                    <div id="formset-container" style="display: none;">
                        {{ formset.management_form }}
                        <div id="formset-forms"></div>
                    </div>
                    
                    {# Preview area ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà #}
                    <div id="image-preview" class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                </div>

                <div class="flex gap-2 justify-end">
                    <a href="{% url 'dog_detail' dog.id %}" class="btn btn-outline btn-error">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
                    <button type="submit" class="btn btn-primary text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                </div>
            </form>
        {% else %}
            {# ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• #}
            <div class="mb-8">
                <h2 class="text-2xl font-semibold mb-4 text-primary-blue-custom">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h2>
                <div class="carousel w-full rounded-box shadow-lg">
                    {% for image in dog_images %}
                        <div id="slide{{ forloop.counter }}" class="carousel-item relative w-full h-96">
                            <img src="{{ image.image.url }}" class="w-full object-cover" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏∏‡∏ô‡∏±‡∏Ç {{ dog.name }} #{{ forloop.counter }}" />
                            <div class="absolute flex justify-between transform -translate-y-1/2 left-5 right-5 top-1/2">
                                <a href="#slide{% if forloop.first %}{{ dog_images.count }}{% else %}{{ forloop.counter0 }}{% endif %}" class="btn btn-circle">‚ùÆ</a> 
                                <a href="#slide{% if forloop.last %}1{% else %}{{ forloop.counter|add:1 }}{% endif %}" class="btn btn-circle">‚ùØ</a>
                            </div>
                        </div> 
                    {% empty %}
                        <div class="w-full h-64 bg-gray-200 flex items-center justify-center rounded-box">
                            <span class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="bg-base-100 p-6 rounded-lg shadow-md space-y-4">
                <h2 class="text-2xl font-semibold border-b pb-2 text-primary-blue-custom">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡πÄ‡∏û‡∏®:</p>
                        <p class="text-lg">{{ gender_display|default:"-" }}</p>
                    </div>
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏≠‡∏≤‡∏¢‡∏∏:</p>
                        <p class="text-lg">{{ dog.age|default:"-" }} ‡∏õ‡∏µ</p>
                    </div>
                    {% comment %} <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</p>
                        <p class="text-lg">{{ dog.breed|default:"-" }}</p>
                    </div> {% endcomment %}
                    
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å/‡∏™‡∏µ‡∏£‡∏≠‡∏á:</p>
                        <p class="text-lg">{{ dog.primary_color|default:"-" }} / {{ dog.secondary_color|default:"-" }}</p>
                    </div>
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏Ç‡∏ô‡∏≤‡∏î:</p>
                        <p class="text-lg">{{ size_display|default:"-" }}</p>
                    </div>
                    {% comment %} <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å:</p>
                        <p class="text-lg">{% if dog.weight %}{{ dog.weight }} ‡∏Å‡∏Å.{% else %}-{% endif %}</p>
                    </div> {% endcomment %}
                    
                    <div class="md:col-span-2 data-block">
                        <p class="font-bold text-gray-700">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞/‡∏£‡∏≠‡∏¢‡∏ï‡∏≥‡∏´‡∏ô‡∏¥‡πÄ‡∏î‡πà‡∏ô:</p>
                        <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ dog.distinguishing_marks|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ" }}</div>
                    </div>
                    
                    <div class="md:col-span-2 space-y-3">
                        <div class="data-block">
                            <p class="font-bold text-gray-700">‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏∏‡∏ô‡∏±‡∏Ç:</p>
                            <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ dog.personality|default:"-" }}</div>
                        </div>
                        <div class="data-block">
                            <p class="font-bold text-gray-700">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î:</p>
                            <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ dog.favorite_food|default:"-" }}</div>
                        </div>
                        <div class="data-block">
                            <p class="font-bold text-gray-700">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ (Allergies):</p>
                            <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ dog.allergies|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ" }}</div>
                        </div>
                        {%if dog.organization %}
                            <div class="data-block">
                                <p class="font-bold text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏´‡∏°‡∏±‡∏ô:</p>
                                <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ sterilization_display|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ" }}</div>
                                {%if sterilization_display %}
                                    <p class="font-bold text-gray-700">‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</p>
                                    <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ dog.sterilization_date|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ" }}</div>
                                {% endif %}
                            </div>
                            <div class="data-block">
                                <p class="font-bold text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô:</p>
                                {% comment %} <div class="whitespace-pre-wrap p-3 bg-gray-50 rounded-md border border-gray-200">{{ sterilization_display|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ" }}</div> {% endcomment %}
                                {% if vaccine_display_list %}
                                    <ul>
                                    {% for vaccine in vaccine_display_list %}
                                        <li>‚úÖ {{ vaccine }}</li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="text-gray-500">‚Äî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‚Äî</p>
                                {% endif %}
                            </div>
                        {% endif %}
                        {% comment %}  {% endcomment %}
                    </div>
                </div>
            </div>
            
            <div class="bg-base-100 p-6 rounded-lg shadow-md space-y-4 mt-8">
                <h2 class="text-2xl font-semibold border-b pb-2 text-primary-blue-custom">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</p>
                        <p class="text-lg">{{ dog.owner.username|default:"-" }}</p>
                    </div>
                    {% if dog.owner.phone %}
                    <div class="data-block">
                        <p class="font-bold text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</p>
                        <p class="text-lg">{{ dog.owner.phone }}</p>
                    </div>
                    {% endif %}
                    {% if dog.owner.line_id %}
                    <div class="data-block">
                        <p class="font-bold text-gray-700">Line ID:</p>
                        <p class="text-lg">{{ dog.owner.line_id }}</p>
                    </div>
                    {% endif %}
                    {% if not dog.owner.phone and not dog.owner.line_id %}
                         <div class="data-block md:col-span-2">
                            <p class="text-gray-500 italic">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p> 
                        </div>
                    {% endif %}
                    {% comment %} <div class="md:col-span-2 mt-2">
                         <p class="text-sm text-gray-400">
                            * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)
                        </p>
                    </div> {% endcomment %}
                </div>
            </div>
            <div class="mt-5 text-center">
                {% if dog.organization and request.user.role == 'user' %}
                    <button class="btn btn-info" onclick="adoption_modal.showModal()">‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡∏ö‡∏∏‡∏ç‡∏ò‡∏£‡∏£‡∏°</button>
                    
                    <dialog id="adoption_modal" class="modal">
                        <div class="modal-box">
                            <h3 class="font-bold text-lg text-primary-blue-custom">‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡∏ö‡∏∏‡∏ç‡∏ò‡∏£‡∏£‡∏°</h3>
                            <p class="py-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞ "<strong>{{ dog.name }}</strong>" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                            <form method="post" action="{% url 'request_adoption' dog.id %}">
                                {% csrf_token %}
                                <div class="form-control mb-4">
                                    <label class="label">
                                        <span class="label-text">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</span>
                                    </label> 
                                    <textarea name="reason" class="textarea textarea-bordered h-24" placeholder="‡∏ö‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π‡πÅ‡∏•‡∏ô‡πâ‡∏≠‡∏á {{ dog.name }}..."></textarea>
                                </div>
                                <div class="modal-action">
                                    <button type="button" onclick="adoption_modal.close()" class="btn btn-outline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                    <button type="submit" class="btn btn-primary text-white">‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
                                </div>
                            </form>
                        </div>
                        <form method="dialog" class="modal-backdrop">
                            <button>close</button>
                        </form>
                    </dialog>
                {% endif %}
            </div>
            
            <div class="mt-8 text-right">
                {% if not is_edit_mode and can_edit %}
                <div class="flex gap-2">
                    <a href="{% url 'dog_detail' dog.id %}?edit=true" class="btn btn-warning text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l4.125-4.125a1.875 1.875 0 112.652 2.652l-4.125 4.125a4.5 4.5 0 01-1.897 1.13L6 18l-2.685-.8a4.5 4.5 0 01-1.13-1.897l4.125-4.125a1.875 1.875 0 112.652-2.652L16.862 4.487z" />
                        </svg>
                        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </a>
                    <a href="{% url 'report_lost_dog' dog.id %}" class="btn btn-error text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                        ‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢
                    </a>
                    <button onclick="delete_modal.showModal()" class="btn btn-error text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                        ‡∏•‡∏ö‡∏™‡∏∏‡∏ô‡∏±‡∏Ç
                    </button>
                    <a href="{% url 'dog_list' %}" class="btn btn-outline btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h18" />
                        </svg>
                        ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏ô‡∏±‡∏Ç
                    </a>
                </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
    
    {# Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö #}
    <dialog id="delete_modal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg text-error">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</h3>
            <p class="py-4">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏∏‡∏ô‡∏±‡∏Ç "<strong>{{ dog.name }}</strong>" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
            <p class="text-sm text-gray-500 mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</p>
            <div class="modal-action">
                <form method="post" action="{% url 'delete_dog_page' dog.id %}">
                    {% csrf_token %}
                    <button type="button" onclick="delete_modal.close()" class="btn btn-outline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn btn-error text-white">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>
    
    {% if is_edit_mode %}
    {% block extra_scripts %}
    <!-- Dropzone Custom JS -->
    <script src="{% static 'dropzone-custom.js' %}"></script>
    <script>
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Dropzone Formset Handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const dropzone = initDropzoneFormset({
        dropzoneId: 'dropzone-area',
        formsetContainerId: 'formset-container',
        formsetFormsId: 'formset-forms',
        previewContainerId: 'image-preview',
        formId: 'dog-edit-form',
        maxFiles: 5,
        existingImagesCount: {{ dog_images.count|default:0 }}
    });
    
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    if (dropzone) {
        document.querySelectorAll('.remove-existing-image').forEach(btn => {
            btn.addEventListener('click', function() {
                const imageItem = this.closest('.existing-image-item');
                const deleteCheckbox = imageItem.querySelector('input[type="checkbox"][name$="-DELETE"]');
                if (deleteCheckbox) {
                    deleteCheckbox.checked = true;
                    imageItem.style.opacity = '0.5';
                    imageItem.style.pointerEvents = 'none';
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï formset ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°
                    if (dropzone.updateFormset) {
                        dropzone.updateFormset();
                    }
                }
            });
        });
    }
    </script>
    {% endblock %}
    {% endif %}
{% endblock %}
